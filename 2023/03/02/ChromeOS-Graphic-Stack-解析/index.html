<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  


  <meta name="generator" content="Hexo 6.3.0">

  

  

  
    <meta name="author" content="Jin Zhihao">
  

  

  

  <title>ChromeOS Graphic Stack 解析 | Alkaid</title>

  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.3/index.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/monokai.css">
  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(/background.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          Alkaid
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">首页</a></li>
        
          <li class="navbar-list-item"><a href="/links">友链</a></li>
        
          <li class="navbar-list-item"><a href="/about">关于</a></li>
        
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">ChromeOS Graphic Stack 解析</h1>
          <h2 class="title-sub-wrap">
            <strong>Jin Zhihao</strong>
            <span>发布于</span>
            <time  class="article-date" datetime="2023-03-02T02:41:17.000Z" itemprop="datePublished">2023-03-02</time>
          </h2>
          
            <h2 class="title-sub-wrap new-date">
              <span>最后更新于</span>
              <time  class="article-updated" datetime="2023-03-16T08:24:58.895Z" itemprop="dateUpdated">2023-03-16</time>
            </h2>
          
          
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
    <li><a href="/tags/ChromeOS-Graphic-Stack/">🏷️ ChromeOS Graphic Stack</a></li>
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- 文章 -->

<!-- 文章内容 -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <h1 id="ChromeOS-Graphic-Stack-解析"><a href="#ChromeOS-Graphic-Stack-解析" class="headerlink" title="ChromeOS Graphic Stack 解析"></a>ChromeOS Graphic Stack 解析</h1><p>  本文参考了 <strong>ChromeOS</strong> 开发者在社区上的分享视频：<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=aIAGM09lEHY">ChromeOS Graphic 101</a><br>  基于这个视频内容,本文将对整个 <strong>ChormeOS Graphic</strong> 的设计以及运行原理进行一个全面地介绍，并结合四个例子讲述其如何工作。</p>
<h2 id="万物伊始：什么是-Graphic"><a href="#万物伊始：什么是-Graphic" class="headerlink" title="万物伊始：什么是 Graphic"></a>万物伊始：什么是 Graphic</h2><p>  作为一个拥有可视化界面的操作系统，<strong>ChromeOS</strong> 能够将各种应用以图形化的方式展示在用户面前并允许用户交互：<br>  <img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/example.png"><br>  在上图所示的界面中，我们能够通过<strong>显示器</strong>看到浏览器，我们的编辑器，以及我们自己的应用 <em><strong>同时展示在屏幕上</strong></em> ，并且能够通过和其上的 UI 组件交互来使用这些应用及服务。<br>  这些功能，就是由 <strong>ChromeOS Graphic</strong> 来实现的。它通过提供图形化的服务来让操作系统实现一个可视化的交互界面。  </p>
<h2 id="ChromeOS-Graphic-整体结构"><a href="#ChromeOS-Graphic-整体结构" class="headerlink" title="ChromeOS Graphic 整体结构"></a>ChromeOS Graphic 整体结构</h2><p>  <strong>ChromeOS</strong> 是 <strong>Chrome</strong> 为了其旗下的笔记本产品 <strong>Chromebook</strong> 所设计的一套操作系统，其中的 <strong>ChromeOS Graphic Stack</strong> 部分负责了显示部分的功能，即像用户提供了可视化的操作界面。整个 <strong>ChromeOS Graphic</strong> 的结构图大致如下:<br><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/ChromeOS-结构图.png"><br>  可以看到，整个 <strong>ChromeOS Graphic</strong> 大致可以分为三个部分：</p>
<ul>
<li><p><strong>Harware(硬件层)</strong><br>这部分是渲染并展示界面的部分</p>
</li>
<li><p><strong>Kernel: DRM</strong><br>这部分是操作系统内核调用硬件的部分，它通过接受 <strong>Ozone DRM</strong> 的请求来调用硬件执行各种服务</p>
</li>
<li><p><strong>Ozone</strong><br><strong>Ozone</strong> 实际上是一层封装，让应用层的程序通过 <strong>Ozone</strong> 来调用硬件的服务而不是直接通过内核</p>
</li>
<li><p><strong>Exo</strong><br><strong>ChromeOS</strong> Graphic 不仅支持运行 <strong>Chrome</strong> 原生的应用( UI，Chrome 系统自带的应用)，同时也支持运行安卓应用与 Linux 应用，这种能力的实现依靠于 <strong>Exo</strong> 以及 <strong>Wayland</strong> 协议<br>接下来，我们将从底层开始一层一层向上拓展，最终再由几个例子开始自顶向下地梳理 <strong>ChromeOS Graphic</strong> 的工作原理。</p>
</li>
</ul>
<h2 id="Hardware-硬件层"><a href="#Hardware-硬件层" class="headerlink" title="Hardware 硬件层"></a>Hardware 硬件层</h2><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/ChromeOS-结构图.png">
 
<p>  硬件层由许多图形处理相关的硬件组成，比如我们大家熟知的 <strong>GPU</strong>。通常来说，<strong>Graphic</strong> 硬件层基本上由三个主要的单元组成：  </p>
<ul>
<li>3D Engine</li>
<li>Video Engine</li>
<li>Display Engine</li>
</ul>
<p>  接下来我们分别看看这三个部分的功能：  </p>
<h3 id="3D-Engine"><a href="#3D-Engine" class="headerlink" title="3D Engine"></a>3D Engine</h3><p>  <strong>3D Engine</strong> 接受一系列对图形的描述，将其展开为像素(pixel)的 <strong>buffer</strong>（即最终传输到显示器上的内容）<br>  <img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/3D-Engine.png"><br>  从图中可以看到，<strong>3D Engine</strong> 其实是 pixel buffer 的 producer，后续会有其他服务(consumer)使用这些 pixel buffer。  </p>
<h3 id="Video-Engine"><a href="#Video-Engine" class="headerlink" title="Video Engine"></a>Video Engine</h3><p>  <strong>Video Engine</strong> 接受编码后的视频数据流，将其(即将展示在屏幕上的)帧转换为 <strong>pixel buffer</strong>，这个过程实际上就是视频解码的过程  </p>
  <img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/video-engine.png">  
  
<p>  与 <strong>3D Engine</strong>对比我们可以发现，<strong>Video Engine</strong>同样也是 pixel buffer 的 producer<br>  同时，除了能够解码视频，<strong>Video Engine</strong>也支持编码视频，也就是它可以作为 consumer 接受 pixel buffer 作为输入。</p>
<h3 id="Display-Engine"><a href="#Display-Engine" class="headerlink" title="Display Engine"></a>Display Engine</h3><p>  <strong>Display Engine</strong> 从 buffer 中读取 pixel，并将其显示在屏幕上<br>  <img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/display-engine.png"><br>  从图中可以看到，<strong>Display Engine</strong> 是一个 consumer，它接受其它 engine 产生的 pixel buffer 并将其显示在屏幕上，在遇到多个应用需要同时显示时，它允许进行 overlay(重叠)以产生一个 pixel 数据显示到屏幕上。  </p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>  从上面的介绍可以看到，硬件层的 <strong>3D Engine</strong> 和 <strong>Video Engine</strong> 负责接受对图形的各种描述，产生 pixel buffer，最终交给 <strong>Display Engine</strong> 来展示在显示器上。 </p>
<h2 id="DRM-x2F-KMS"><a href="#DRM-x2F-KMS" class="headerlink" title="DRM&#x2F;KMS"></a>DRM&#x2F;KMS</h2>  <img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/ChromeOS-结构图.png">
  
<p>  接下来让我们来看看 <strong>ChromeOS</strong> 的内核是如何控制硬件层的，即 <strong>DRM（Direct Rendering Manager,直接渲染管理）</strong><br>  <strong>DRM</strong> 允许了用户空间（user space）向图形硬件层发送各种请求，其中比较重要的一个部分是 **KMS(Kernal Mode Setting)**，它控制了如何让硬件层去展示 graphic，比如多个页面如何展示在同一个屏幕上。<br>  <strong>DRM</strong> 有两个主要功能：  </p>
<ul>
<li><strong>Atomic Display Updates</strong>:<br>更新屏幕显示设置，<strong>HW overlays</strong>（硬件重叠：指每个要显示的图形都分别在不同的硬件中渲染存储，最终按照顺序直接叠加显示，这样的好处是加快了更细速率，是典型的空间换时间的一种思想。想了解更多请看<a target="_blank" rel="noopener" href="https://cashchou.com/2012/12/14/hw-overlay-%E5%B0%8F%E6%AA%94%E6%A1%88/">这篇博客</a>）设置。<strong>Atmoic</strong> 体现在它能够让多个不同的 graphic 显示在同一个屏幕上（称之为一个 <strong>atomic unit</strong>，宣传的口号是”All or nothing”，关于 <strong>atmoic display</strong> 的文章可以看看这个 <a target="_blank" rel="noopener" href="https://lwn.net/Articles/653071/">Atomic mode setting design overview</a> 。</li>
<li><strong>Buffer Sharing</strong><br>这里的 buffer 指的就是前面硬件层提到过的 pixel buffer。通过 <strong>DMABufs</strong> 框架，我们可以将 buffer 抽象为一个文件描述符，从而实现跨进程的 buffer sharing（更多深入了解请看<a target="_blank" rel="noopener" href="https://elinux.org/images/a/a8/DMA_Buffer_Sharing-_An_Introduction.pdf">这篇文档</a>）。此外它也为安卓&#x2F;Linux 应用提供了共享 Buffer 的支持。<br>为什么 Buffer Sharing 这么重要？以一个 4K 屏幕为例，一个 buffer 的大小是 32MB，1s 以60个 buffer 计算（60帧）。会发现对内存的占用非常大，最终导致整个 OS 的图形界面看起来非常卡。</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>  可以看到，DRM 封装了底层硬件的细节，并向用户空间提供了直接访问渲染的 API, 所有的 user space 的应用和服务都需要通过 DRM 才能与硬件进行交互。</p>
<h2 id="User-Space-Driver"><a href="#User-Space-Driver" class="headerlink" title="User Space Driver"></a>User Space Driver</h2><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/ChromeOS-结构图.png">

<h3 id="MiniGBM"><a href="#MiniGBM" class="headerlink" title="MiniGBM"></a><a href="#MiniGBM" title="MiniGBM"></a>MiniGBM</h3><p>  <strong>MiniGBM</strong> 是对 Memory Allocation 的一种抽象，运行在用户空间（user space）中。它为应用程序提供了向 Kernal 申请并管理 graphic buffer 的能力（主要是为了 GPU, video，camera）。比方说我的相机应用希望申请一块buffer用于存储拍到的图像，那么我就可以通过<strong>MiniGBM</strong> 来申请（依靠 <strong>DMABufs</strong> 的能力，<strong>MiniGBM</strong> 在代码层面而不是 IR Code（编译的中间产物）层面支持了 buffer sharing）。<br>  <strong>MiniGBM</strong> 拥有许多后端，因此能兼容多种硬件平台（Intel，ADM，Rockchip，etc）。<br>  总而言之，<strong>MiniGBM</strong> 隐藏了硬件平台的实现细节，为应用程序提供了通用的图形缓冲区管理框架。将应用程序与底层的硬件程序解耦，使得跨驱动程序的兼容和移植成为可能。<br>  <a target="_blank" rel="noopener" href="https://github.com/intel/minigbm">更多了解MiniGBM</a></p>
<h3 id="GLES-x2F-Vulkan-Drivers"><a href="#GLES-x2F-Vulkan-Drivers" class="headerlink" title="GLES&#x2F;Vulkan Drivers"></a><a href="#GLES-x2F-Vulkan-Drivers" title="GLES&#x2F;Vulkan Drivers"></a>GLES&#x2F;Vulkan Drivers</h3><p>  GLES(OpenGL ES)和 Vulkan 封装了基本的图形渲染功能。在讲到硬件层的时候我们曾提到，<strong>3D Engine</strong> 可以接受图形的描述作为输入，输出 pixel buffers。这个功能被封装在 GLES&#x2F;Vulkan 驱动中，我们可以无视硬件细节调用它。即 GLES&#x2F;Vulkan 封装了硬件的细节，向用户空间的程序提供了一个调用底层硬件的接口。</p>
<ul>
<li><p>一点点拓展：ChromeOS 中的各种应用如何调用 user space 的 GLE&#x2F;Vulkan 驱动？</p>
<ul>
<li><p>所有 ChromeOS 中应用通过 向<strong>Viz</strong> 进程发起请求来间接调用 user space 的驱动，即每个应用都会向 Viz 进程发送自己的渲染请求，由 Viz 进程去和 user space 的驱动交互并返回结果。这样的设计有两个好处：</p>
<ol>
<li>可以保护硬件安全（你也不想你的 GPU 天天被奇怪的 web或者应用直接操作吧）</li>
<li>在 crash 后可以立刻重启恢复显示</li>
</ol>
</li>
<li><p>所有 Linux app 以及虚拟机应用 通过类似的名为 <strong>Virgil</strong> 的技术来实现 GPU 的虚拟化。它让 Linux 应用和虚拟机应用以 client 的形式发送渲染请求并接受返回结果。</p>
<ul>
<li>关于 Virgil<br>   Virgil 可以使虚拟化环境（如虚拟机）以近似原生性能访问图形硬件。当在 Chromebook 上运行的 Linux 应用程序发出 OpenGL 或 Vulkan API 调用时，virgl 库将 API 调用序列化并转发到 virgl renderer 内核驱动程序提供的虚拟图形适配器。虚拟图形适配器将 API 调用反序列化后转换为可以由主机图形硬件执行的命令，并将结果返回给 virgl 库，后者将其转发给 Linux 应用程序。</li>
</ul>
</li>
<li><p>所有 Android 应用程序运行在一个容器里，因此可以直接与 user space 的驱动进行交互</p>
<ul>
<li>为了与 Chrome 原生的应用区分开来，我们有两个调用 GLES&#x2F;Vulkan 库的 instance ，一个给 ChromeOS 使用，另一个给 Android System 使用（不过官方目前(2020年)正在计划将其迁移到一个虚拟机内，也就是以后 Android 应用可能也是走 Virgil 去和 GLES&#x2F;Vulkan 交互）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Ozone"><a href="#Ozone" class="headerlink" title="Ozone"></a>Ozone</h3><p>  我们终于可以开始看看属于 Chrome 的一个 user space driver 了。它将所有的 DRM 级别的细节全部隐藏，为上层应用抽象了各种接口使用（比如同步图像，设置显示器，申请内存）。</p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>可以看到，user space 层的各种驱动基本都是做了一层 DRM 上的封装，从而让各种平台的应用（Android，Chrome原生，Linux app以及虚拟机应用）能够忽略平台差异控制硬件完成各种渲染需求。</p>
<h2 id="Chrome-层"><a href="#Chrome-层" class="headerlink" title="Chrome 层"></a>Chrome 层</h2><p>  这一层我们将介绍一部分 ChromeOS Graphic 应用层的部分。  </p>
<img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/chrome-compositor.png">


<p>这个东西最初被设计出来是用于合成网页内容的（毕竟 ChromeOS 开发团队的上一个产品是 Chrome 浏览器），现在 ChromeOS 用它来合成 ChromeOS 的 UI。它接受多个 image，然后将其合成为一个 image，最后交由底层渲染并显示在屏幕上。<br>让我们回忆最初看到的效果图：</p>
<img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/example.png">

<p> 其中有网页，有 Linux 应用，有 Android 应用，Chrome Compositor 将它们各自的 image 合成为了最终我们看到的 image。根据展示效果的不同，有时候 Chrome Compositor 可以直接使用 overlay 将不同的 image 堆叠显示。当遇到比较复杂的展示效果，如失去焦点后的模糊显示时，Chrome Compositor 会使用 OpenGL 来完成效果的渲染。<br> 通常来说，Overlay 的方式是性能比较好的，因为 GPU 硬件实现这个效果基本上是 0 开销。当你引入 OpenGL 来完成渲染时，会引入一次额外的 buffer copy（想想我们前面提到的 4K 屏的例子）。所以到底是是用 Overlay 方式展示还是使用 OpenGL 渲染额外效果，是一个功能性和性能的取舍。<br> 当然，现在 Chrome Compositor 正在迁移到 Skia Compositor 的过程中， Skia Compos 基于自己实现的一个 Rendering Library 取代了 OpenGL。它的工作流程和 Chome Compositor 一样：先试试 Overlay 行不行，不行咱就走自己的渲染引擎。</p>
<h2 id="UI-层"><a href="#UI-层" class="headerlink" title="UI 层"></a>UI 层</h2><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/ChromeOS-结构图.png">

<h3 id="ChromeOS-UI：Ash（Aura-Shell）"><a href="#ChromeOS-UI：Ash（Aura-Shell）" class="headerlink" title="ChromeOS UI：Ash（Aura Shell）"></a>ChromeOS UI：Ash（Aura Shell）</h3><p>ChromeOS Compositor 的其中一个 client, 它充分利用了 Compositor 提供的各种特性并实现了各种独特的效果（如预览，下拉阴影等）。所有的 UI（窗口，按钮，壁纸）都是在这个 client 中完成。</p>
<h3 id="Exo-Exosphere"><a href="#Exo-Exosphere" class="headerlink" title="Exo(Exosphere)"></a>Exo(Exosphere)</h3><p>Exo 能够让所有已知的 web 应用和 Chrome-native 的应用在 ChromeOS 中展示。在整个 ChromeOS Graphic 的架构图中，Exo 扮演的角色是作为让非 web 应用和非 ChromeOS 原生的应用能够在 ChromeOS 中展示的接口。</p>
<p>Exo 本身是ChromeOS 的 Display Compositor 的一个 client</p>
<h4 id="Exo-到底做了什么？"><a href="#Exo-到底做了什么？" class="headerlink" title="Exo 到底做了什么？"></a>Exo 到底做了什么？</h4><p>Exo 位于 Chrome Compositor 的上层，允许其他 UI 层的 client （安卓，linux应用，虚拟机应用），和 Chrome 原生的应用一起被 Chrome Compositor 合成一个 image。</p>
<h4 id="Exo-如何实现这点？"><a href="#Exo-如何实现这点？" class="headerlink" title="Exo 如何实现这点？"></a>Exo 如何实现这点？</h4><p>一方面，Exo 作为 display server 实现了 Wayland 协议，允许应用向 Exo 发送展示 buffer（即展示自己的界面）的请求。</p>
<p>另一方面，在从 Wayland 侧拿到要展示的界面后，Exo 会将它们插入 compositing tree 交给 Chorme Compositor 去合成。</p>
<h4 id="Exo-for-ChromeOS"><a href="#Exo-for-ChromeOS" class="headerlink" title="Exo for ChromeOS"></a>Exo for ChromeOS</h4><p>除了基本的功能外，Exo 还为 ChromeOS 实现了一些额外的特性(如 display scaling, window frames for blending)</p>
<h3 id="ARC-Android-application-support-for-ChromeOS"><a href="#ARC-Android-application-support-for-ChromeOS" class="headerlink" title="ARC++(Android application support for ChromeOS)"></a>ARC++(Android application support for ChromeOS)</h3><p><strong>ARC++</strong> 允许安卓应用以 Chrome 原生的图形表现运行在 ChromeOS 中。<br><strong>ARC++</strong> 嵌入了完整的安卓系统(包括了 <strong>SurfaceFlinger</strong> 和 <strong>Hardware Composer</strong>)。</p>
<ul>
<li><p>Surface Flinger<br>安卓的 Displaye Server</p>
</li>
<li><p>Hardware Composer<br>Surface Flinger 的 backend</p>
</li>
</ul>
<p><strong>ARC++</strong> 与安卓系统展示图形不同的地方在于，从硬件处完成渲染拿到 buffer 后，它并不将其直接显示，而是交给 Exo （Exo本身是一个 display server），由 Exo 来交给 Chrome Compositor 来合成一个 image。<br>需要注意的是，<strong>ARC++</strong> 在渲染拿到 buffer 的过程中依然是通过 DMAbufs 来实现的，因此不会产生 buffer copy 带来的性能问题。</p>
<p>安卓本身有一个 Gralloc 库来实现GPU memory allocation，在 ChromeOS 中，它在 MiniGBM 顶层实现了 Gralloc。这样做是为了充分复用之前提到的MinGBM 之下的那些驱动。</p>
<h3 id="Linux-Crostini-Linux-application-support-for-ChromeOS"><a href="#Linux-Crostini-Linux-application-support-for-ChromeOS" class="headerlink" title="Linux Crostini(Linux application support for ChromeOS)"></a>Linux Crostini(Linux application support for ChromeOS)</h3><p>Linux 应用运行在虚拟机中，<strong>Crostini</strong> 则使其能够拥有和 Chrome 原生一样的图形表现能力。</p>
<p>通过 <strong>Virgil</strong> ，<strong>Crostini</strong> 实现了对图形硬件的完全虚拟化。<br><strong>Virgil</strong> 将应用的图形命令序列化，交给 host（访问GPU硬件,反序列化后）执行。序列化和反序列化的过程是为了保证数据安全。</p>
<p>在图形展示方面，<strong>Crostini</strong> 与安卓有一些不同：它在虚拟机中运行基于 X11 Wayland，XWayland 协议的 Display Server。然后和 Exo 通信。</p>
<h2 id="Show-Case"><a href="#Show-Case" class="headerlink" title="Show Case"></a>Show Case</h2><h3 id="HTML-–-gt-Screen"><a href="#HTML-–-gt-Screen" class="headerlink" title="HTML –&gt; Screen"></a>HTML –&gt; Screen</h3><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/HTML-to-Screen.png">

<p>可以看到，HTML 通过 Blink 完成渲染后，首先传递给 Viz 进程，Viz 进程通过 GPU Raster 过程获取用于最终展示的 buffer。之后交给 Compositor 来合成为一个 image。最终交给 Ozone 给底层硬件用于展示。</p>
<p>HTML的显示过程代表了 ChromeOS 原生的 app 的显示过程。这个过程也可以用下图来描述：</p>
<img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/HTML-to-Screen-step.png">

<h3 id="Android-app-–-gt-Screen"><a href="#Android-app-–-gt-Screen" class="headerlink" title="Android app –&gt; Screen"></a>Android app –&gt; Screen</h3><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/Android-to-Screen.png">

<p>安卓应用通过 Gralloc 申请 buffer，通过 GLES&#x2F;Vk 完成渲染后，将 buffer 交给 Surface Flinger，告诉它我希望显示这个buffer。Surface Flinger 接着访问 HWC ，HWC 则将这个请求交给 Exo 来实现，通过 Exo 转换后，后续的流程就和前面 HTML 的 Compositor 以后的流程相同了。 </p>
<p>这个过程用流程图描述如下：</p>
<img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/Android-to-Screen-step.png">

<h3 id="Linux-app-–-gt-Screen"><a href="#Linux-app-–-gt-Screen" class="headerlink" title="Linux app –&gt; Screen"></a>Linux app –&gt; Screen</h3><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/Linux-to-Screen.png">

<p>Linux app 的显示有一点点复杂。在通过 Virgil 完成渲染并拿到 buffer 后，Linux app 会将它交给 XWayland，因为 Linux app 使用的是 X11，所以需要通过 XWayland 将其转换为 Wayland API 请求供 Exo 使用。之后要 通过 Sommelier（一个 daemon process） 将 buffer 在虚拟机中的 id 转换为在 ChromeOS 中的 id。之后就可以交给 Exo 来处理显示请求了。Exo 之后的步骤则和之前一样。<br>这个过程也可以用如下流程图描述：<br><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/Linux-to-Screen-step.png"></p>
<h3 id="Display-plug-in-外接屏"><a href="#Display-plug-in-外接屏" class="headerlink" title="Display plug in(外接屏)"></a>Display plug in(外接屏)</h3><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/plugin.png">

<p>在外接屏硬件接入时，首先会触发一个中断。Kernel 会捕获这个中断，唤起一个 interrupt handler 将中断转换为一个 user space 的 event 并发送给 Ozone。Ozone 接受 event 以后告知 Display Configurator 更新显示设置，Display Configurator 会查询一次系统的显示 state。<br>直到这个阶段，我们的外接屏其实都不会显示内容（这也是为什么我们插入外接屏的时候会有一段时间的黑屏）。<br>Display Configurator 决定好给外接屏的显示设置后，就会让 Ozone 渲染要显示给外接屏的buffer并显示在外接屏上，这个时候我们就能看到外接屏显示内容了。<br>细心的读者可能看到右上角还有一个箭头，那个的意思就是外接屏接入后，还会通知系统应用（比如settings 应用更新外接屏的信息）。</p>
<p>具体的流程图：<br><img src="/2023/03/02/ChromeOS-Graphic-Stack-%E8%A7%A3%E6%9E%90/plugin-step.png"></p>

      </section>

      
      
        <nav class="article-nav">
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2023/03/16/hello-world/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">Hello World</h2>
        </a>
      
      <div class="card-text--row">Newer</div>
    </div>
  </article>
</div>
          
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="/avatar.jpg" class="soft-size--round soft-style--box" alt="Alkaid">
    
    
      <h2>Alkaid</h2>
    
    
      <p>乐</p>
    

    <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>2</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        1
      </div>
    </div>
  </div>
</section>

      

      

      <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section>

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>TAGS</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      <a href="/tags/ChromeOS-Graphic-Stack/" style="font-size: 10px;" class="tags-cloud-0">ChromeOS Graphic Stack</a>
    </div>
  </div>
</section>
    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    
    <div class="social-icons">
      
        
          <a href="x" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-ins" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 0C372.906667 0 355.541333 0.64 300.928 3.072 246.4 5.632 209.28 14.208 176.64 26.88c-33.664 13.056-62.250667 30.592-90.709333 59.050667S39.893333 142.933333 26.88 176.64C14.208 209.28 5.589333 246.4 3.072 300.928 0.512 355.541333 0 372.906667 0 512s0.64 156.458667 3.072 211.072c2.56 54.485333 11.136 91.648 23.808 124.288a251.093333 251.093333 0 0 0 59.050667 90.709333A250.368 250.368 0 0 0 176.64 997.12c32.682667 12.629333 69.802667 21.290667 124.288 23.808C355.541333 1023.488 372.906667 1024 512 1024s156.458667-0.64 211.072-3.072c54.485333-2.56 91.648-11.178667 124.288-23.808a251.648 251.648 0 0 0 90.709333-59.050667 250.026667 250.026667 0 0 0 59.050667-90.709333c12.629333-32.64 21.290667-69.802667 23.808-124.288 2.56-54.613333 3.072-71.978667 3.072-211.072s-0.64-156.458667-3.072-211.072c-2.56-54.485333-11.178667-91.690667-23.808-124.288a251.306667 251.306667 0 0 0-59.050667-90.709333A249.472 249.472 0 0 0 847.36 26.88c-32.64-12.672-69.802667-21.290667-124.288-23.808C668.458667 0.512 651.093333 0 512 0z m0 92.16c136.661333 0 152.96 0.682667 206.933333 3.029333 49.92 2.346667 77.013333 10.624 95.018667 17.706667 23.978667 9.258667 40.96 20.352 58.965333 38.229333 17.877333 17.92 28.970667 34.944 38.229334 58.922667 6.997333 18.005333 15.36 45.098667 17.621333 95.018667 2.432 54.016 2.986667 70.229333 2.986667 206.933333s-0.64 152.96-3.157334 206.933333c-2.602667 49.92-10.922667 77.013333-17.962666 95.018667a162.56 162.56 0 0 1-38.357334 58.965333 159.744 159.744 0 0 1-58.88 38.229334c-17.92 6.997333-45.44 15.36-95.36 17.621333-54.357333 2.432-70.357333 2.986667-207.317333 2.986667-137.002667 0-153.002667-0.64-207.317333-3.157334-49.962667-2.602667-77.482667-10.922667-95.402667-17.962666a158.549333 158.549333 0 0 1-58.837333-38.357334 155.477333 155.477333 0 0 1-38.4-58.88c-7.04-17.92-15.317333-45.44-17.92-95.36-1.92-53.76-2.602667-70.357333-2.602667-206.677333 0-136.362667 0.682667-153.002667 2.602667-207.402667 2.602667-49.92 10.88-77.397333 17.92-95.317333 8.96-24.32 20.437333-40.96 38.4-58.922667 17.877333-17.877333 34.56-29.397333 58.837333-38.314666 17.92-7.082667 44.842667-15.402667 94.762667-17.962667 54.4-1.92 70.4-2.56 207.317333-2.56l1.92 1.28z m0 156.928a262.912 262.912 0 1 0 0 525.824 262.912 262.912 0 1 0 0-525.824zM512 682.666667c-94.293333 0-170.666667-76.373333-170.666667-170.666667s76.373333-170.666667 170.666667-170.666667 170.666667 76.373333 170.666667 170.666667-76.373333 170.666667-170.666667 170.666667z m334.762667-443.946667a61.482667 61.482667 0 0 1-122.88 0 61.44 61.44 0 0 1 122.88 0z"></path>
</svg>

          </a>
        
      
        
          <a href="x" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg t="1587373160860" class="icon icon-zhihu" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M544.949 561.422s0-71.387-34.779-75.050c-34.779-3.663-142.775 0-142.775 0v-219.654h161.078s-1.83-73.219-32.949-73.219h-261.755l43.93-117.148s-65.897 3.663-89.692 45.761-98.844 252.604-98.844 252.604 25.627 10.983 67.726-20.134c42.101-31.116 56.743-86.033 56.743-86.033l76.879-3.663 1.83 223.316s-133.621-1.83-161.078 0c-27.457 1.83-42.101 75.050-42.101 75.050h203.182s-18.307 124.47-69.557 214.164c-53.085 89.692-151.929 161.078-151.929 161.078s71.387 29.287 140.947-10.983c69.557-42.101 120.811-223.316 120.811-223.316l162.912 203.182s14.643-97.013-1.83-124.47c-18.307-27.457-113.49-137.283-113.49-137.283l-42.101 36.607 29.287-120.811h177.552zM587.050 188.010l-1.83 660.793h65.897l23.795 82.37 115.321-82.37h162.912v-660.793h-366.091zM879.92 775.584h-76.879l-97.013 75.050-21.965-75.050h-20.134v-512.527h215.991v512.527z"></path>
</svg>
          </a>
        
      
        
          <a href="x" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-weibo" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M385.682429 733.696q11.995429-19.456 6.290286-39.424t-25.746286-28.598857q-19.456-7.972571-41.691429-0.585143t-34.304 26.258286q-12.580571 19.456-7.460571 39.131429t24.576 28.891429 42.569143 1.462857 35.693714-27.136zM439.442429 664.576q4.534857-7.460571 1.974857-15.140571t-10.020571-10.605714q-7.972571-2.852571-16.310857 0.292571t-12.288 10.605714q-9.728 17.700571 7.460571 25.746286 7.972571 2.852571 16.603429-0.292571t12.580571-10.605714zM538.843572 725.723429q-25.746286 58.294857-90.258286 85.723429t-128 6.875429q-61.147429-19.456-84.260571-72.265143t3.730286-107.154286q26.843429-53.174857 86.601143-79.433143t120.32-10.825143q63.414857 16.603429 90.550857 68.315429t1.462857 108.836571zM717.165858 634.294857q-5.12-54.857143-50.834286-97.133714t-119.149714-62.317714-156.891429-11.995429q-127.414857 13.165714-211.163429 80.822857t-75.702857 151.113143q5.12 54.857143 50.834286 97.133714t119.149714 62.317714 156.891429 11.995429q127.414857-13.165714 211.163429-80.822857t75.702857-151.113143zM893.147572 636.562286q0 38.838857-21.138286 79.725714t-62.317714 78.262857-96.256 67.145143-129.170286 47.396571-154.550857 17.700571-157.110857-19.163429-137.435429-53.174857-98.011429-86.308571-37.156571-114.029714q0-65.682286 39.716571-139.995429t112.859429-147.456q96.548571-96.548571 195.145143-134.875429t140.873143 4.022857q37.156571 36.571429 11.410286 119.442286-2.267429 7.972571-0.585143 11.410286t5.705143 4.022857 8.265143-0.292571 7.68-1.974857l3.437714-1.170286q79.433143-33.718857 140.580571-33.718857t87.405714 34.889143q25.746286 35.986286 0 101.741714-1.170286 7.460571-2.56 11.410286t2.56 7.168 6.875429 4.315429 9.728 3.437714q32.548571 10.313143 58.88 26.843429t45.714286 46.592 19.456 66.56zM850.871001 279.990857q23.990857 26.843429 31.158857 62.025143t-3.730286 67.145143q-4.534857 13.165714-16.822857 19.456t-25.453714 2.267429q-13.165714-4.534857-19.456-16.822857t-2.267429-25.453714q11.410286-35.986286-13.677714-63.414857t-61.147429-19.968q-13.677714 2.852571-25.746286-4.534857t-14.262857-21.138286q-2.852571-13.677714 4.534857-25.453714t21.138286-14.555429q34.304-7.460571 68.022857 3.145143t57.709714 37.449143zM954.295001 186.88q49.737143 54.857143 64.292571 127.122286t-7.68 138.020571q-5.12 15.433143-19.456 22.820571t-29.696 2.267429-22.820571-19.456-2.852571-29.696q16.018286-46.884571 5.705143-98.304t-45.714286-90.258286q-35.401143-39.424-84.553143-54.564571t-98.889143-4.827429q-16.018286 3.437714-29.696-5.412571t-17.115429-24.868571 5.412571-29.403429 24.868571-16.822857q70.290286-14.848 139.410286 6.582857t118.857143 76.873143z"></path>
</svg>
          </a>
        
      
        
          <a href="https://github.com/Alkaid-10" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
        
          <a href="x" class="soft-size--primary soft-style--box" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-twitter" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571 0.571429 8 0.571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143 0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429 0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429 0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571l0-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714 0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"></path>
</svg>
          </a>
        
      
    </div>
     
    <p>&copy; 2023 <a href="/" target="_blank">Jin Zhihao</a></p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> Theme - <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <p>
      <a href="javascript:;" id="theme-light">🌞 浅色</a>
      <a href="javascript:;" id="theme-dark">🌛 深色</a>
      <a href="javascript:;" id="theme-auto">🤖️ 自动</a>
    </p>
  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->




  


  


  




<script src="/js/script.js"></script>


  
  <!-- 尾部用户自定义相关内容 -->
</body>
</html>
